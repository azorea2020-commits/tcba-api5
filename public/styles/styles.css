<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TCBA Membership Signup</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="signup-container">
    <h1>üêù Join the Treasure Coast Bee Association</h1>

    <form id="signup-form">
      <label>Name</label><br/>
      <input id="signup-username" type="text" placeholder="Full Name" required /><br/>

      <label>Email</label><br/>
      <input id="signup-email" type="email" placeholder="you@example.com" required /><br/>

      <label>PIN (4‚Äì6 digits)</label><br/>
      <input id="signup-pin" type="password" maxlength="6" minlength="4" required /><br/><br/>

      <button type="submit" class="btn">Create Account</button>
    </form>

    <p id="signup-status"></p>
  </div>

  <script src="config.js"></script>
  <script>
    document.getElementById("signup-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("signup-username").value.trim();
      const email = document.getElementById("signup-email").value.trim();
      const pin = document.getElementById("signup-pin").value.trim();
      const status = document.getElementById("signup-status");

      if (!username || !email || !pin) {
        status.textContent = "All fields are required.";
        return;
      }

      try {
        const res = await fetch(`${window.TCBA_API_BASE}/signup`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, email, password: pin })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Signup failed");

        // Save member info in local cache
        localStorage.setItem("tcbaMember", JSON.stringify({ username, email, pin }));
        window.location.href = "welcome.html";
      } catch (err) {
        status.textContent = "Error: " + err.message;
        status.style.color = "red";
      }
    });
  </script>
</body>
</html>
