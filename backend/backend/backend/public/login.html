<!doctype html><meta charset="utf-8">
<title>TCBA Login Test</title>
<h1>TCBA Login Test</h1>
<a href="/auth/google">Continue with Google</a>
<form id="f">
  <input name="email" type="email" placeholder="Email" required>
  <input name="password" type="password" placeholder="Password" required>
  <button>Sign in / Sign up</button>
</form>
<pre id="out"></pre>
<script>
const post=(u,d)=>fetch(u,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(d)}).then(r=>r.json());
document.getElementById('f').addEventListener('submit',async e=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const email=fd.get('email'), password=fd.get('password');
  let r=await post('/login',{email,password}).catch(()=>null);
  if(!r||r.error){ await post('/signup',{email,password,name:'TCBA User'}); r=await post('/login',{email,password}); }
  document.getElementById('out').textContent=JSON.stringify(await fetch('/me',{credentials:'include'}).then(r=>r.json()),null,2);
});
</script>
